<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>üîç Teste AR - Motorola Edge 30</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .card { background: white; border-radius: 15px; padding: 25px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; margin-bottom: 20px; }
        h2 { color: #202124; margin: 20px 0 10px; }
        .success { color: #0d9d58; border-left: 5px solid #0d9d58; padding-left: 15px; }
        .error { color: #d93025; border-left: 5px solid #d93025; padding-left: 15px; }
        .warning { color: #f9ab00; border-left: 5px solid #f9ab00; padding-left: 15px; }
        button { background: #1a73e8; color: white; border: none; padding: 14px 28px; border-radius: 8px; font-size: 16px; margin: 10px 5px; cursor: pointer; }
        .test-result { padding: 15px; border-radius: 8px; margin: 10px 0; }
        .pass { background: #e6f4ea; }
        .fail { background: #fce8e6; }
        pre { background: #f1f3f4; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîç Diagn√≥stico AR - Motorola Edge 30</h1>
        <p>Testando compatibilidade do seu dispositivo com Realidade Aumentada</p>
    </div>
    
    <div class="card">
        <h2>üì± Informa√ß√µes do Dispositivo</h2>
        <div id="deviceInfo"></div>
    </div>
    
    <div class="card">
        <h2>üîß Testes de Compatibilidade</h2>
        
        <div class="test-result" id="test1">
            <strong>Teste 1: WebXR API</strong>
            <div id="test1Result">Testando...</div>
        </div>
        
        <div class="test-result" id="test2">
            <strong>Teste 2: AR Session Support</strong>
            <div id="test2Result">Testando...</div>
        </div>
        
        <div class="test-result" id="test3">
            <strong>Teste 3: Scene Viewer</strong>
            <div id="test3Result">Testando...</div>
        </div>
        
        <div class="test-result" id="test4">
            <strong>Teste 4: Permiss√µes de C√¢mera</strong>
            <div id="test4Result">Testando...</div>
        </div>
    </div>
    
    <div class="card">
        <h2>üöÄ A√ß√µes Diretas</h2>
        <button onclick="testWebXR()">üîÑ Testar WebXR Novamente</button>
        <button onclick="openSceneViewer()">üì± Abrir Scene Viewer</button>
        <button onclick="openARCoreTest()">üß™ Teste Oficial ARCore</button>
        <button onclick="clearCache()">üóëÔ∏è Limpar Cache do Site</button>
    </div>
    
    <div class="card" id="solution" style="display: none;">
        <h2>üõ†Ô∏è Solu√ß√£o Recomendada</h2>
        <div id="solutionText"></div>
    </div>
    
    <div class="card">
        <h2>üìã Log de Diagn√≥stico</h2>
        <pre id="log"></pre>
    </div>

    <script>
        const log = document.getElementById('log');
        const solutionDiv = document.getElementById('solution');
        const solutionText = document.getElementById('solutionText');
        
        function addLog(message) {
            log.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }
        
        // Coletar informa√ß√µes do dispositivo
        function collectDeviceInfo() {
            const info = document.getElementById('deviceInfo');
            const details = [
                `Navegador: ${navigator.userAgent}`,
                `Plataforma: ${navigator.platform}`,
                `Idioma: ${navigator.language}`,
                `User Agent: ${navigator.userAgent}`,
                `WebGL: ${detectWebGL() ? '‚úÖ Suportado' : '‚ùå N√£o suportado'}`,
                `HTTPS: ${window.location.protocol === 'https:' ? '‚úÖ Sim' : '‚ùå N√£o (PROBLEMA!)'}`,
                `ARCore instalado: ‚úÖ Sim (confirmado)`
            ];
            
            info.innerHTML = details.map(d => `<p>${d}</p>`).join('');
            
            // Detectar Motorola Edge 30 especificamente
            const isMotorolaEdge30 = /Motorola.*Edge.*30/.test(navigator.userAgent) || 
                                    /XT\d{4}/.test(navigator.userAgent);
            
            if (isMotorolaEdge30) {
                addLog('‚úÖ Motorola Edge 30 detectado');
                info.innerHTML += `<p class="success">‚úÖ Dispositivo: Motorola Edge 30 (Compat√≠vel com AR)</p>`;
            }
        }
        
        function detectWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && 
                         (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch (e) {
                return false;
            }
        }
        
        // Teste 1: Verificar WebXR API
        async function testWebXR() {
            const test1Result = document.getElementById('test1Result');
            const test1Div = document.getElementById('test1');
            
            if (!navigator.xr) {
                test1Result.innerHTML = `<span class="error">‚ùå WebXR n√£o dispon√≠vel no navegador</span>`;
                test1Div.className = 'test-result fail';
                addLog('WebXR API n√£o encontrada');
                return false;
            }
            
            test1Result.innerHTML = `<span class="success">‚úÖ WebXR API dispon√≠vel</span>`;
            test1Div.className = 'test-result pass';
            addLog('WebXR API dispon√≠vel');
            return true;
        }
        
        // Teste 2: Verificar suporte a sess√£o AR
        async function testARSession() {
            const test2Result = document.getElementById('test2Result');
            const test2Div = document.getElementById('test2');
            
            if (!navigator.xr) {
                test2Result.innerHTML = `<span class="error">‚ùå WebXR n√£o dispon√≠vel</span>`;
                test2Div.className = 'test-result fail';
                return false;
            }
            
            try {
                const supported = await navigator.xr.isSessionSupported('immersive-ar');
                
                if (supported) {
                    test2Result.innerHTML = `<span class="success">‚úÖ Sess√£o AR suportada</span>`;
                    test2Div.className = 'test-result pass';
                    addLog('Sess√£o AR WebXR suportada');
                    return true;
                } else {
                    test2Result.innerHTML = `<span class="warning">‚ö†Ô∏è Sess√£o AR n√£o suportada (mas ARCore est√° instalado)</span>`;
                    test2Div.className = 'test-result fail';
                    addLog('Sess√£o AR WebXR n√£o suportada, mesmo com ARCore instalado');
                    return false;
                }
            } catch (error) {
                test2Result.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
                test2Div.className = 'test-result fail';
                addLog(`Erro WebXR: ${error.message}`);
                return false;
            }
        }
        
        // Teste 3: Verificar Scene Viewer
        function testSceneViewer() {
            const test3Result = document.getElementById('test3Result');
            const test3Div = document.getElementById('test3');
            
            // Verificar se √© Android
            const isAndroid = /Android/.test(navigator.userAgent);
            
            if (!isAndroid) {
                test3Result.innerHTML = `<span class="warning">‚ö†Ô∏è Scene Viewer s√≥ funciona em Android</span>`;
                test3Div.className = 'test-result';
                addLog('N√£o √© Android, Scene Viewer n√£o aplic√°vel');
                return false;
            }
            
            test3Result.innerHTML = `<span class="success">‚úÖ Scene Viewer dispon√≠vel (Android detectado)</span>`;
            test3Div.className = 'test-result pass';
            addLog('Scene Viewer dispon√≠vel para Android');
            return true;
        }
        
        // Teste 4: Verificar permiss√µes de c√¢mera
        async function testCameraPermissions() {
            const test4Result = document.getElementById('test4Result');
            const test4Div = document.getElementById('test4');
            
            try {
                // Primeiro verificar se a API est√° dispon√≠vel
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    test4Result.innerHTML = `<span class="warning">‚ö†Ô∏è API de m√≠dia n√£o dispon√≠vel</span>`;
                    test4Div.className = 'test-result';
                    addLog('API de m√≠dia n√£o dispon√≠vel');
                    return false;
                }
                
                // Tentar acessar a c√¢mera
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                // Parar a c√¢mera imediatamente
                stream.getTracks().forEach(track => track.stop());
                
                test4Result.innerHTML = `<span class="success">‚úÖ Permiss√£o de c√¢mera concedida</span>`;
                test4Div.className = 'test-result pass';
                addLog('Permiss√£o de c√¢mera concedida');
                return true;
                
            } catch (error) {
                test4Result.innerHTML = `<span class="error">‚ùå Erro c√¢mera: ${error.name}</span>`;
                test4Div.className = 'test-result fail';
                addLog(`Erro permiss√£o c√¢mera: ${error.name}`);
                return false;
            }
        }
        
        // Fun√ß√µes de a√ß√£o
        function openSceneViewer() {
            // URL direta para Scene Viewer com modelo de teste
            const sceneViewerUrl = 'https://arvr.google.com/scene-viewer?file=https://modelviewer.dev/shared-assets/models/Astronaut.glb&mode=ar_only';
            window.open(sceneViewerUrl, '_blank');
            addLog('Abrindo Scene Viewer...');
        }
        
        function openARCoreTest() {
            window.open('https://developers.google.com/ar/test', '_blank');
            addLog('Abrindo teste oficial ARCore...');
        }
        
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                    addLog('Cache limpo');
                    alert('Cache do navegador limpo para este site. Recarregue a p√°gina.');
                });
            } else {
                alert('API Cache n√£o dispon√≠vel. Limpe manualmente nas configura√ß√µes do Chrome.');
            }
        }
        
        // Analisar resultados e sugerir solu√ß√£o
        function analyzeResults() {
            const isHTTPS = window.location.protocol === 'https:';
            const isAndroid = /Android/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent);
            
            let solution = '';
            
            if (!isHTTPS) {
                solution = `
                    <p class="error"><strong>PROBLEMA PRINCIPAL: ‚ùå N√ÉO EST√Å EM HTTPS</strong></p>
                    <p>AR s√≥ funciona em HTTPS. Voc√™ est√° em: ${window.location.protocol}</p>
                    <p><strong>Solu√ß√£o:</strong> Hospede este arquivo no GitHub Pages ou em um servidor HTTPS.</p>
                    <p>Teste imediatamente: <button onclick="location.href='https://seu-usuario.github.io/seu-repositorio/'">Abrir via GitHub Pages</button></p>
                `;
            } else if (!isAndroid) {
                solution = `<p class="warning">‚ö†Ô∏è Voc√™ n√£o est√° em um dispositivo Android. AR pode ter comportamento diferente.</p>`;
            } else if (!isChrome) {
                solution = `
                    <p class="warning"><strong>Poss√≠vel problema: Navegador n√£o √© Chrome</strong></p>
                    <p>Seu navegador: ${navigator.userAgent.split(' ').pop()}</p>
                    <p><strong>Solu√ß√£o:</strong> Use o Google Chrome para melhor compatibilidade com AR.</p>
                `;
            } else {
                solution = `
                    <p class="success"><strong>‚úÖ Configura√ß√£o b√°sica OK</strong></p>
                    <p>Seu Motorola Edge 30 tem todos os requisitos para AR:</p>
                    <ul>
                        <li>‚úÖ HTTPS (GitHub Pages)</li>
                        <li>‚úÖ ARCore instalado</li>
                        <li>‚úÖ Android + Chrome</li>
                    </ul>
                    <p><strong>Se ainda n√£o funciona:</strong> Pode ser um bug tempor√°rio. Tente:</p>
                    <ol>
                        <li>Reiniciar o celular</li>
                        <li>Atualizar Chrome na Play Store</li>
                        <li>Testar em modo an√¥nimo</li>
                    </ol>
                `;
            }
            
            solutionText.innerHTML = solution;
            solutionDiv.style.display = 'block';
        }
        
        // Executar todos os testes
        async function runAllTests() {
            addLog('=== INICIANDO DIAGN√ìSTICO AR ===');
            
            collectDeviceInfo();
            await testWebXR();
            await testARSession();
            testSceneViewer();
            await testCameraPermissions();
            
            analyzeResults();
            
            addLog('=== DIAGN√ìSTICO COMPLETO ===');
        }
        
        // Iniciar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', runAllTests);
        
        // Adicionar bot√£o para recarregar e limpar cache local
        window.addEventListener('load', function() {
            const reloadButton = document.createElement('button');
            reloadButton.textContent = 'üîÑ Recarregar e Testar Novamente';
            reloadButton.onclick = function() {
                localStorage.clear();
                sessionStorage.clear();
                location.reload(true);
            };
            document.querySelector('.card:last-child').appendChild(reloadButton);
        });
    </script>
</body>
</html>
